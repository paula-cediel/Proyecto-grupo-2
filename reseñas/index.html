<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>PublicaciÃ³n</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body{background:#f5f5f5}
  .card{width:420px;margin:20px auto;border-radius:15px}
  .profile-pic{width:70px;height:70px;border-radius:50%;object-fit:cover;cursor:pointer;background:#ddd}
  .star{font-size:26px;cursor:pointer;color:#ccc}
  .star.active{color:gold}
  .btn-actions{font-size:20px;cursor:pointer;margin-right:12px}
  .comment{background:#eee;padding:6px 10px;border-radius:10px;margin-bottom:5px}
</style>
</head>

<body>

<div class="card p-3 shadow">
  <div class="text-center mb-2">
    <label>
      <input type="file" id="imgInput" hidden>
      <img id="preview" class="profile-pic">
    </label>
  </div>

  <input id="name" class="form-control mb-2" placeholder="Nombre">
  <textarea id="desc" class="form-control mb-2" placeholder="DescripciÃ³n"></textarea>

  <div class="text-center mb-2">
    <span class="star" data-v="1">â˜…</span>
    <span class="star" data-v="2">â˜…</span>
    <span class="star" data-v="3">â˜…</span>
    <span class="star" data-v="4">â˜…</span>
    <span class="star" data-v="5">â˜…</span>
  </div>

  <button id="publicar" class="btn btn-dark w-100">Publicar</button>
</div>

<div id="posts"></div>

<script>
let rating = 0;

document.querySelectorAll(".star").forEach(s=>{
  s.onclick=()=>{
    rating = s.dataset.v;
    document.querySelectorAll(".star").forEach(x=>{
      x.classList.toggle("active", x.dataset.v <= rating);
    });
  };
});

document.getElementById("imgInput").addEventListener("change", e=>{
  const file=e.target.files[0];
  const r=new FileReader();
  r.onload=()=>document.getElementById("preview").src=r.result;
  r.readAsDataURL(file);
});

document.getElementById("publicar").onclick=()=>{
  const n=document.getElementById("name").value;
  const d=document.getElementById("desc").value;
  const img=document.getElementById("preview").src;

  const card=document.createElement("div");
  card.className="card p-3 shadow mb-3";

  const stars="â˜…".repeat(rating)+"â˜†".repeat(5-rating);

  card.innerHTML=`
    <div class="d-flex align-items-center mb-2">
      <img class="profile-pic me-2" src="${img}">
      <div><h5 class="m-0">${n}</h5><small>${stars}</small></div>
    </div>

    <p class="texto">${d}</p>

    <div class="d-flex">
      <span class="btn-actions like">â¤ï¸ <span class="like-count">0</span></span>
      <span class="btn-actions comment-btn">ğŸ’¬</span>
      <span class="btn-actions edit">âœï¸</span>
      <span class="btn-actions delete">ğŸ—‘ï¸</span>
    </div>

    <div class="comment-box mt-2" style="display:none">
      <input class="form-control comment-input" placeholder="Comentario...">
      <button class="btn btn-sm btn-dark mt-1 send-comment">Enviar</button>
    </div>

    <div class="comments mt-2"></div>
  `;

  // â¤ï¸ LIKE CON CONTADOR
  card.querySelector(".like").onclick=()=>{
    const likeBtn = card.querySelector(".like");
    const count = card.querySelector(".like-count");

    if (likeBtn.classList.contains("text-danger")) {
      likeBtn.classList.remove("text-danger");
      count.textContent = Number(count.textContent) - 1;
    } else {
      likeBtn.classList.add("text-danger");
      count.textContent = Number(count.textContent) + 1;
    }
  };

  card.querySelector(".comment-btn").onclick=()=>{
    const box=card.querySelector(".comment-box");
    box.style.display= box.style.display==="none" ? "block" : "none";
  };

  card.querySelector(".send-comment").onclick=()=>{
    const txt=card.querySelector(".comment-input").value;
    if(!txt.trim())return;
    const c=document.createElement("div");
    c.className="comment";
    c.textContent=txt;
    card.querySelector(".comments").appendChild(c);
    card.querySelector(".comment-input").value="";
  };

  card.querySelector(".delete").onclick=()=>card.remove();

  card.querySelector(".edit").onclick=()=>{
    const nuevo=prompt("Nuevo texto:", card.querySelector(".texto").textContent);
    if(nuevo?.trim()) card.querySelector(".texto").textContent=nuevo;
  };

  document.getElementById("posts").prepend(card);

  document.getElementById("name").value="";
  document.getElementById("desc").value="";
  document.querySelectorAll(".star").forEach(s=>s.classList.remove("active"));
  rating=0;
  document.getElementById("preview").src="";
};
</script>

</body>
</html>
